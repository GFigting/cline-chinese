# 使用 Cline 从头构建自定义 MCP 服务器：完整指南

本指南提供了使用 Cline 从头开始构建自定义 MCP（模型上下文协议）服务器的完整步骤。我们将以构建一个"GitHub 助手服务器"为例来说明这个过程。

## 理解 MCP 和 Cline 在构建服务器中的角色

### 什么是 MCP？

模型上下文协议（MCP）充当大型语言模型（LLMs，如 Claude）与外部工具和数据之间的桥梁。MCP 包含两个关键组件：

-   **MCP 主机：** 这些是与 LLMs 集成的应用程序，如 Cline、Claude Desktop 等。
-   **MCP 服务器：** 这些是专门设计的小型程序，通过 MCP 向 LLMs 提供数据或特定功能。

当你有一个符合 MCP 的聊天界面（如 Claude Desktop）时，这种设置很有用，它可以利用这些服务器来访问信息和执行操作。

### 为什么使用 Cline 创建 MCP 服务器？

Cline 通过利用其 AI 功能来简化 MCP 服务器的构建和集成过程：

-   **理解自然语言指令：** 你可以用自然的方式与 Cline 交流，使开发过程直观且用户友好。
-   **克隆仓库：** Cline 可以直接从 GitHub 克隆现有的 MCP 服务器仓库，简化使用预构建服务器的过程。
-   **构建服务器：** 一旦必要的代码就位，Cline 可以执行像 `npm run build` 这样的命令来编译和准备服务器。
-   **处理配置：** Cline 管理 MCP 服务器所需的配置文件，包括将新服务器添加到 `cline_mcp_settings.json` 文件中。
-   **协助故障排除：** 如果在开发或测试过程中出现错误，Cline 可以帮助识别原因并提出解决方案，使调试更容易。

## 使用 Cline 构建 GitHub 助手服务器：分步指南

本节演示如何使用 Cline 创建一个 GitHub 助手服务器。这个服务器将能够与 GitHub 数据交互并执行有用的操作：

### 1. 定义目标和初始需求

首先，你需要向 Cline 清楚地传达你的服务器的目的和功能：

-   **服务器目标：** 告诉 Cline 你想要构建一个"GitHub 助手服务器"。指定这个服务器将与 GitHub 数据交互，并可能提到你感兴趣的数据类型，如问题、拉取请求和用户资料。
-   **访问要求：** 让 Cline 知道你需要访问 GitHub API。解释这可能需要一个个人访问令牌（GITHUB_TOKEN）进行身份验证。
-   **数据具体性（可选）：** 你可以选择告诉 Cline 你想从 GitHub 提取的具体数据字段，但这也可以在定义服务器的工具时确定。

### 2. Cline 启动项目设置

根据你的指示，Cline 开始项目设置过程：

-   **项目结构：** Cline 可能会询问你服务器的名称。之后，它使用 MCP `create-server` 工具为你的 GitHub 助手服务器生成基本的项目结构。这通常涉及创建一个新目录，其中包含基本文件如 `package.json`、`tsconfig.json` 和用于 TypeScript 代码的 `src` 文件夹。
-   **代码生成：** Cline 生成服务器的启动代码，包括：
    -   **文件处理工具：** 帮助读取和写入文件的函数，通常用于存储数据或日志。
    -   **GitHub API 客户端：** 与 GitHub API 交互的代码，通常使用像 `@octokit/graphql` 这样的库。Cline 可能会询问你的 GitHub 用户名或你想要处理的仓库。
    -   **核心服务器逻辑：** 处理来自 Cline 的请求并将它们路由到适当函数的基本框架，按照 MCP 定义。
-   **依赖管理：** Cline 分析代码并识别必要的依赖项，将它们添加到 `package.json` 文件中。例如，与 GitHub API 交互可能需要像 `@octokit/graphql`、`graphql`、`axios` 或类似的包。
-   **依赖安装：** Cline 执行 `npm install` 来下载和安装 `package.json` 中列出的依赖项，确保你的服务器具有所有必需的库来正常运行。
-   **路径修正：** 在开发过程中，你可能会移动文件或目录。Cline 智能地识别这些变化并自动更新代码中的文件路径以保持一致性。
-   **配置：** Cline 将修改 `cline_mcp_settings.json` 文件以添加你的新 GitHub 助手服务器。这将包括：
    -   **服务器启动命令：** Cline 将添加启动服务器的适当命令（例如，`npm run start` 或类似命令）。
    -   **环境变量：** Cline 将添加所需的 `GITHUB_TOKEN` 变量。Cline 可能会询问你的 GitHub 个人访问令牌，或者指导你将其安全地存储在单独的环境文件中。
-   **进度文档：** 在整个过程中，Cline 保持"记忆库"文件的更新。这些文件记录项目的进度，突出显示已完成的任务、正在进行的任务和待处理的任务。

### 3. 测试 GitHub 助手服务器

一旦 Cline 完成设置和配置，你就可以测试服务器的功能了：

-   **使用服务器工具：** Cline 将在你的服务器中创建各种"工具"，代表操作或数据检索功能。要进行测试，你可以指示 Cline 使用特定工具。以下是与 GitHub 相关的示例：
    -   **`get_issues`：** 要测试检索问题，你可以对 Cline 说，"Cline，使用 GitHub 助手服务器的 `get_issues` 工具向我显示 'cline/cline' 仓库中的开放问题。"Cline 随后会执行这个工具并向你展示结果。
    -   **`get_pull_requests`：** 要测试拉取请求检索，你可以让 Cline "使用 `get_pull_requests` 工具向我显示 'facebook/react' 仓库中上个月的已合并拉取请求。"Cline 会执行这个工具，使用你的 GITHUB_TOKEN 访问 GitHub API，并显示请求的数据。
-   **提供必要信息：** Cline 可能会提示你提供执行工具所需的额外信息，如仓库名称、特定日期范围或其他过滤条件。
-   **Cline 执行工具：** Cline 处理与 GitHub API 的通信，检索请求的数据，并以清晰易懂的格式呈现。

### 4. 完善服务器并添加更多功能

开发通常是迭代的。在使用你的 GitHub 助手服务器时，你会发现需要添加新功能或改进现有功能。Cline 可以协助这个持续的过程：

-   **与 Cline 讨论：** 与 Cline 讨论你对新工具或改进的想法。例如，你可能想要一个 `create_issue` 或 `get_user_profile` 工具。与 Cline 讨论这些工具所需的输入和输出。
-   **代码完善：** Cline 可以帮助你编写新功能所需的代码。Cline 可以生成代码片段，建议最佳实践，并帮助你调试出现的任何问题。
-   **测试新功能：** 在添加新工具或功能后，你会再次使用 Cline 进行测试，确保它们按预期工作并与服务器的其余部分良好集成。
-   **与其他工具集成：** 你可能想要将你的 GitHub 助手服务器与其他工具集成。例如，在"github-cline-mcp"源代码中，Cline 协助将服务器与 Notion 集成，创建一个跟踪 GitHub 活动的动态仪表板。

通过遵循这些步骤，你可以使用 Cline 从头开始创建一个自定义 MCP 服务器，利用其强大的 AI 功能来简化整个过程。Cline 不仅协助服务器构建的技术方面，还帮助你思考设计、功能和潜在的集成。